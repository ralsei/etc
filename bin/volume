#!/bin/sh

send_notification() {
    volume=$(ponymix --sink get-volume | awk '{print int($1 / 3.25)}')
    # Make the bar with the special character ─ (it's not dash -)
    # https://en.wikipedia.org/wiki/Box-drawing_character
    bar=$(seq -s "─" "$volume" | sed 's/[0-9]//g')
    # Send the notification
    makoctl dismiss
    notify-send -t 1000 "vol:  $bar"
}

case $1 in
    up)
        # Set the volume on (if it was muted)
        ponymix --sink unmute
        # Up the volume (+ 5%)
        ponymix --sink increase 5
        send_notification
        ;;
    down)
        ponymix --sink unmute
        ponymix --sink decrease 5
        send_notification
        ;;
    mute)
        # Toggle mute
        ponymix --sink toggle
        if ponymix --sink is-muted; then
            makoctl dismiss
            notify-send -t 1000 "volume muted"
        else
            send_notification
        fi
        ;;
    *) echo "usage: volume [up|down|mute]" ;;
esac
